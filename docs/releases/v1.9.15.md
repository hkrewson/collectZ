# v1.9.15

## Version and date
- Version: `1.9.15`
- Date: `2026-02-23`

## Milestone target and status
- Target: 1.9.15 invite-token hardening
- Status: Completed

## Summary
Hardened invite handling by hashing invite tokens at rest, removing token leakage from list endpoints, and preserving one-time token visibility only at invite creation.

## What changed
### Backend
- Added invite token hashing helper service.
- Updated invite creation to store `token_hash` and not persist raw token values.
- Updated registration claim flow to resolve invites by token hash (with legacy fallback).
- Updated invite claim update to key by invite `id`.
- Updated invite list endpoint to exclude token material.
- Added migration `v13` to backfill `token_hash`, drop token not-null constraint, and clear stored plaintext invite tokens.

### Frontend
- Updated admin invite flow to keep one-time invite URL in creation banner only.
- Removed reliance on `inv.token` from invitation list rows.

### Database
- Added `invites.token_hash` and unique index for hashed token values.
- Migrated existing invite tokens to hashed form and removed plaintext values.

### Docs/Ops
- Added this release note and version bump metadata updates.
- CI migration check now verifies `invites.token_hash` exists.

## Breaking changes
- Invite list responses no longer include reusable raw token values.

## Environment/config changes
- No new environment variables required.

## Migration and data impact
- Migration `v13` applies invite token hashing/backfill and plaintext token cleanup.
- Existing unclaimed invites remain claimable using original invite URL tokens.

## Deployment and verification
1. Rebuild and restart stack:
   - `docker compose --env-file .env up -d --build`
2. Confirm backend health reports `1.9.15`.
3. Create a new invite and verify:
   - one-time URL is shown on create,
   - invite list row does not expose token.
4. Register via invite URL and confirm claim succeeds.
5. Confirm old invite list/load/revoke behavior still works.

## Rollback guidance
- Roll back to prior image tag and restore DB backup if invite-token plaintext rollback is required.

## Known issues and follow-up
- Remaining pre-2.0 hardening continues in `1.9.16` through `1.9.20`.
