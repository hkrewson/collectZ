# v1.9.22

## Version and date
- Version: `1.9.22`
- Date: `2026-02-24`

## Milestone target and status
- Target: 1.9.22 session/cookie hardening verification
- Status: Completed

## Summary
Hardened production auth/session posture by removing integration-key fallback behavior, enforcing secure cookie startup constraints, and adding CI checks for security headers and cookie attributes.

## What changed
### Frontend
- No functional frontend UI changes.

### Backend
- Removed integration crypto fallback behavior; `INTEGRATION_ENCRYPTION_KEY` is now required in all environments.
- Added startup production assertions:
  - `SESSION_SECRET` must be set,
  - `INTEGRATION_ENCRYPTION_KEY` must be set,
  - `SESSION_COOKIE_SECURE` must be `true`.
- Updated compose defaults to secure cookies by default.

### Database
- No schema changes.

### Docs/Ops
- Updated environment and compose docs for secure-cookie requirement in production.
- Updated CI/CD documentation with explicit header/cookie smoke assertions.
- Added compose smoke CI checks for:
  - security headers on `/api/health`,
  - CSRF/session cookie attributes (`Secure`, `SameSite=Strict`, session `HttpOnly`).

## Breaking changes
- Production startup now fails if `SESSION_COOKIE_SECURE=false`.
- Missing `INTEGRATION_ENCRYPTION_KEY` now fails startup in all environments.

## Environment/config changes
- `SESSION_COOKIE_SECURE` default is now `true` in `docker-compose.yml` and `env.example`.
- For local plain-http development, use `NODE_ENV=development` and optionally `SESSION_COOKIE_SECURE=false`.

## Migration and data impact
- No migrations required.
- No data changes.

## Deployment and verification
1. Update `.env`:
   - ensure `SESSION_SECRET` is set,
   - ensure `INTEGRATION_ENCRYPTION_KEY` is set,
   - keep `SESSION_COOKIE_SECURE=true` for production/TLS.
2. Rebuild and start:
   - `docker compose --env-file .env up -d --build`
3. Verify:
   - `/api/health` loads,
   - login/register works over HTTPS,
   - CI `compose-smoke` and `secret-scan` jobs pass.

## Rollback guidance
- Revert to prior tag/image and redeploy if this hardening blocks an intended local non-TLS flow.
- No DB rollback required.

## Known issues and follow-up
- Non-TLS local workflows should run as development mode; production mode now enforces secure-cookie policy.
- Further pre-2.0 hardening continues in `1.9.23`+ milestones.
